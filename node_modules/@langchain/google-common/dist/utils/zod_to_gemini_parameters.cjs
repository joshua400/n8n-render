const require_rolldown_runtime = require('../_virtual/rolldown_runtime.cjs');
const __langchain_core_utils_types = require_rolldown_runtime.__toESM(require("@langchain/core/utils/types"));
const __langchain_core_utils_json_schema = require_rolldown_runtime.__toESM(require("@langchain/core/utils/json_schema"));

//#region src/utils/zod_to_gemini_parameters.ts
function adjustObjectType(obj) {
	if (!Array.isArray(obj.type)) return obj;
	const len = obj.type.length;
	const nullIndex = obj.type.indexOf("null");
	if (len === 2 && nullIndex >= 0) {
		const typeIndex = nullIndex === 0 ? 1 : 0;
		obj.type = obj.type[typeIndex];
		obj.nullable = true;
	} else if (len === 1 && nullIndex === 0) throw new Error("zod_to_gemini_parameters: Gemini cannot handle null type");
	else if (len === 1) obj.type = obj?.type[0];
	else throw new Error("zod_to_gemini_parameters: Gemini cannot handle union types");
	return obj;
}
function removeAdditionalProperties(obj) {
	if (typeof obj === "object" && obj !== null) {
		const newObj = { ...obj };
		if ("additionalProperties" in newObj) delete newObj.additionalProperties;
		adjustObjectType(newObj);
		for (const key in newObj) if (key in newObj) {
			if (Array.isArray(newObj[key])) newObj[key] = newObj[key].map(removeAdditionalProperties);
			else if (typeof newObj[key] === "object" && newObj[key] !== null) newObj[key] = removeAdditionalProperties(newObj[key]);
		}
		return newObj;
	}
	return obj;
}
function schemaToGeminiParameters(schema) {
	const jsonSchema = removeAdditionalProperties((0, __langchain_core_utils_types.isInteropZodSchema)(schema) ? (0, __langchain_core_utils_json_schema.toJsonSchema)(schema) : schema);
	const { $schema,...rest } = jsonSchema;
	return rest;
}
function jsonSchemaToGeminiParameters(schema) {
	const jsonSchema = removeAdditionalProperties(schema);
	const { $schema,...rest } = jsonSchema;
	return rest;
}

//#endregion
exports.adjustObjectType = adjustObjectType;
exports.jsonSchemaToGeminiParameters = jsonSchemaToGeminiParameters;
exports.removeAdditionalProperties = removeAdditionalProperties;
exports.schemaToGeminiParameters = schemaToGeminiParameters;
//# sourceMappingURL=zod_to_gemini_parameters.cjs.map