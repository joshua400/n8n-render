{"version":3,"file":"zod_to_gemini_parameters.js","names":["obj: Record<string, any>","schema: InteropZodType<RunOutput> | JsonSchema7Type","schema: Record<string, any>"],"sources":["../../src/utils/zod_to_gemini_parameters.ts"],"sourcesContent":["import {\n  InteropZodType,\n  isInteropZodSchema,\n} from \"@langchain/core/utils/types\";\nimport {\n  type JsonSchema7Type,\n  toJsonSchema,\n} from \"@langchain/core/utils/json_schema\";\nimport {\n  GeminiFunctionSchema,\n  GeminiJsonSchema,\n  GeminiJsonSchemaDirty,\n} from \"../types.js\";\n\nexport function adjustObjectType(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  obj: Record<string, any>\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n): Record<string, any> {\n  if (!Array.isArray(obj.type)) {\n    return obj;\n  }\n\n  const len = obj.type.length;\n  const nullIndex = obj.type.indexOf(\"null\");\n  if (len === 2 && nullIndex >= 0) {\n    // There are only two values set for the type, and one of them is \"null\".\n    // Set the type to the other one and set nullable to true.\n    const typeIndex = nullIndex === 0 ? 1 : 0;\n    obj.type = obj.type[typeIndex];\n    obj.nullable = true;\n  } else if (len === 1 && nullIndex === 0) {\n    // This is nullable only without a type, which doesn't\n    // make sense for Gemini\n    throw new Error(\"zod_to_gemini_parameters: Gemini cannot handle null type\");\n  } else if (len === 1) {\n    // Although an array, it has only one value.\n    // So set it to the string to match what Gemini expects.\n    obj.type = obj?.type[0];\n  } else {\n    // Anything else could be a union type, so reject it.\n    throw new Error(\n      \"zod_to_gemini_parameters: Gemini cannot handle union types\"\n    );\n  }\n  return obj;\n}\n\nexport function removeAdditionalProperties(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  obj: Record<string, any>\n): GeminiJsonSchema {\n  if (typeof obj === \"object\" && obj !== null) {\n    const newObj = { ...obj };\n\n    if (\"additionalProperties\" in newObj) {\n      delete newObj.additionalProperties;\n    }\n\n    adjustObjectType(newObj);\n\n    for (const key in newObj) {\n      if (key in newObj) {\n        if (Array.isArray(newObj[key])) {\n          newObj[key] = newObj[key].map(removeAdditionalProperties);\n        } else if (typeof newObj[key] === \"object\" && newObj[key] !== null) {\n          newObj[key] = removeAdditionalProperties(newObj[key]);\n        }\n      }\n    }\n\n    return newObj as GeminiJsonSchema;\n  }\n\n  return obj as GeminiJsonSchema;\n}\n\nexport function schemaToGeminiParameters<\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  RunOutput extends Record<string, any> = Record<string, any>\n>(schema: InteropZodType<RunOutput> | JsonSchema7Type): GeminiFunctionSchema {\n  // Gemini doesn't accept either the $schema or additionalProperties\n  // attributes, so we need to explicitly remove them.\n  // Zod sometimes also makes an array of type (because of .nullish()),\n  // which needs cleaning up.\n  const jsonSchema = removeAdditionalProperties(\n    isInteropZodSchema(schema) ? toJsonSchema(schema) : schema\n  );\n  const { $schema, ...rest } = jsonSchema;\n\n  return rest;\n}\n\nexport function jsonSchemaToGeminiParameters(\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  schema: Record<string, any>\n): GeminiFunctionSchema {\n  // Gemini doesn't accept either the $schema or additionalProperties\n  // attributes, so we need to explicitly remove them.\n  const jsonSchema = removeAdditionalProperties(\n    schema as GeminiJsonSchemaDirty\n  );\n  const { $schema, ...rest } = jsonSchema;\n\n  return rest;\n}\n"],"mappings":";;;;AAcA,SAAgB,iBAEdA,KAEqB;AACrB,KAAI,CAAC,MAAM,QAAQ,IAAI,KAAK,CAC1B,QAAO;CAGT,MAAM,MAAM,IAAI,KAAK;CACrB,MAAM,YAAY,IAAI,KAAK,QAAQ,OAAO;AAC1C,KAAI,QAAQ,KAAK,aAAa,GAAG;EAG/B,MAAM,YAAY,cAAc,IAAI,IAAI;EACxC,IAAI,OAAO,IAAI,KAAK;EACpB,IAAI,WAAW;CAChB,WAAU,QAAQ,KAAK,cAAc,EAGpC,OAAM,IAAI,MAAM;UACP,QAAQ,GAGjB,IAAI,OAAO,KAAK,KAAK;KAGrB,OAAM,IAAI,MACR;AAGJ,QAAO;AACR;AAED,SAAgB,2BAEdA,KACkB;AAClB,KAAI,OAAO,QAAQ,YAAY,QAAQ,MAAM;EAC3C,MAAM,SAAS,EAAE,GAAG,IAAK;AAEzB,MAAI,0BAA0B,QAC5B,OAAO,OAAO;EAGhB,iBAAiB,OAAO;AAExB,OAAK,MAAM,OAAO,OAChB,KAAI,OAAO,QACT;OAAI,MAAM,QAAQ,OAAO,KAAK,EAC5B,OAAO,OAAO,OAAO,KAAK,IAAI,2BAA2B;YAChD,OAAO,OAAO,SAAS,YAAY,OAAO,SAAS,MAC5D,OAAO,OAAO,2BAA2B,OAAO,KAAK;EACtD;AAIL,SAAO;CACR;AAED,QAAO;AACR;AAED,SAAgB,yBAGdC,QAA2E;CAK3E,MAAM,aAAa,2BACjB,mBAAmB,OAAO,GAAG,aAAa,OAAO,GAAG,OACrD;CACD,MAAM,EAAE,QAAS,GAAG,MAAM,GAAG;AAE7B,QAAO;AACR;AAED,SAAgB,6BAEdC,QACsB;CAGtB,MAAM,aAAa,2BACjB,OACD;CACD,MAAM,EAAE,QAAS,GAAG,MAAM,GAAG;AAE7B,QAAO;AACR"}