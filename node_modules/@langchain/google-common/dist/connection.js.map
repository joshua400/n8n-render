{"version":3,"file":"connection.js","names":["caller: AsyncCaller","client: GoogleAbstractedClient","streaming?: boolean","data: unknown | undefined","_options: CallOptions","requestHeaders: Record<string, string>","opts: GoogleAbstractedClientOps","options: CallOptions","response: unknown","fields: GoogleConnectionParams<AuthOptions> | undefined","fields: GoogleConnectionParams<any> | undefined","fields: GoogleAIBaseLLMInput<AuthOptions> | undefined","input: InputType","parameters: GoogleAIModelRequestParams","runManager?: BaseRunManager","streamingParameters: GoogleAIModelRequestParams","input: MessageType","eventName: string","data: any","runId: string","tags?: string[]","metadata?: Record<string, any>","_eventInfo: GoogleCustomEventInfo","_runId: string","_metadata?: Record<string, any>","_eventName: string","_tags?: string[]"],"sources":["../src/connection.ts"],"sourcesContent":["/* eslint-disable @typescript-eslint/no-explicit-any */\nimport { BaseLanguageModelCallOptions } from \"@langchain/core/language_models/base\";\nimport {\n  AsyncCaller,\n  AsyncCallerCallOptions,\n} from \"@langchain/core/utils/async_caller\";\nimport { getRuntimeEnvironment } from \"@langchain/core/utils/env\";\nimport { BaseRunManager } from \"@langchain/core/callbacks/manager\";\nimport { BaseCallbackHandler } from \"@langchain/core/callbacks/base\";\nimport type {\n  GoogleAIBaseLLMInput,\n  GoogleConnectionParams,\n  GooglePlatformType,\n  GoogleResponse,\n  GoogleLLMResponse,\n  GoogleAIModelRequestParams,\n  GoogleRawResponse,\n  GoogleAIAPI,\n  VertexModelFamily,\n  GoogleAIAPIConfig,\n  AnthropicAPIConfig,\n  GeminiAPIConfig,\n  GoogleModelParams,\n} from \"./types.js\";\nimport {\n  GoogleAbstractedClient,\n  GoogleAbstractedClientOps,\n  GoogleAbstractedClientOpsMethod,\n} from \"./auth.js\";\nimport {\n  getGeminiAPI,\n  modelToFamily,\n  modelToPublisher,\n} from \"./utils/index.js\";\nimport { getAnthropicAPI } from \"./utils/anthropic.js\";\n\nexport abstract class GoogleConnection<\n  CallOptions extends AsyncCallerCallOptions,\n  ResponseType extends GoogleResponse\n> {\n  caller: AsyncCaller;\n\n  client: GoogleAbstractedClient;\n\n  streaming: boolean;\n\n  constructor(\n    caller: AsyncCaller,\n    client: GoogleAbstractedClient,\n    streaming?: boolean\n  ) {\n    this.caller = caller;\n    this.client = client;\n    this.streaming = streaming ?? false;\n  }\n\n  abstract buildUrl(): Promise<string>;\n\n  abstract buildMethod(): GoogleAbstractedClientOpsMethod;\n\n  async _clientInfoHeaders(): Promise<Record<string, string>> {\n    const { userAgent, clientLibraryVersion } = await this._getClientInfo();\n    return {\n      \"User-Agent\": userAgent,\n      \"Client-Info\": clientLibraryVersion,\n    };\n  }\n\n  async _getClientInfo(): Promise<{\n    userAgent: string;\n    clientLibraryVersion: string;\n  }> {\n    const env = await getRuntimeEnvironment();\n    const langchain = env?.library ?? \"langchain-js\";\n    // TODO: Add an API for getting the current LangChain version\n    const langchainVersion = \"0\";\n    const moduleName = await this._moduleName();\n    let clientLibraryVersion = `${langchain}/${langchainVersion}`;\n    if (moduleName && moduleName.length) {\n      clientLibraryVersion = `${clientLibraryVersion}-${moduleName}`;\n    }\n    return {\n      userAgent: clientLibraryVersion,\n      clientLibraryVersion: `${langchainVersion}-${moduleName}`,\n    };\n  }\n\n  async _moduleName(): Promise<string> {\n    return this.constructor.name;\n  }\n\n  async additionalHeaders(): Promise<Record<string, string>> {\n    return {};\n  }\n\n  async _buildOpts(\n    data: unknown | undefined,\n    _options: CallOptions,\n    requestHeaders: Record<string, string> = {}\n  ): Promise<GoogleAbstractedClientOps> {\n    const url = await this.buildUrl();\n    const method = this.buildMethod();\n    const infoHeaders = (await this._clientInfoHeaders()) ?? {};\n    const additionalHeaders = (await this.additionalHeaders()) ?? {};\n    const headers = {\n      ...infoHeaders,\n      ...additionalHeaders,\n      ...requestHeaders,\n    };\n\n    const opts: GoogleAbstractedClientOps = {\n      url,\n      method,\n      headers,\n    };\n    if (data && method === \"POST\") {\n      opts.data = data;\n    }\n    if (this.streaming) {\n      opts.responseType = \"stream\";\n    } else {\n      opts.responseType = \"json\";\n    }\n    return opts;\n  }\n\n  async _request(\n    data: unknown | undefined,\n    options: CallOptions,\n    requestHeaders: Record<string, string> = {}\n  ): Promise<ResponseType> {\n    const opts = await this._buildOpts(data, options, requestHeaders);\n    const callResponse = await this.caller.callWithOptions(\n      { signal: options?.signal },\n      async () => this.client.request(opts)\n    );\n    const response: unknown = callResponse; // Done for typecast safety, I guess\n    return <ResponseType>response;\n  }\n}\n\nexport abstract class GoogleHostConnection<\n    CallOptions extends AsyncCallerCallOptions,\n    ResponseType extends GoogleResponse,\n    AuthOptions\n  >\n  extends GoogleConnection<CallOptions, ResponseType>\n  implements GoogleConnectionParams<AuthOptions>\n{\n  // This does not default to a value intentionally.\n  // Use the \"platform\" getter if you need this.\n  platformType: GooglePlatformType | undefined;\n\n  _endpoint: string | undefined;\n\n  _location: string | undefined;\n\n  _apiVersion: string | undefined;\n\n  constructor(\n    fields: GoogleConnectionParams<AuthOptions> | undefined,\n    caller: AsyncCaller,\n    client: GoogleAbstractedClient,\n    streaming?: boolean\n  ) {\n    super(caller, client, streaming);\n    this.caller = caller;\n\n    this.platformType = this.fieldPlatformType(fields);\n    this._endpoint = fields?.endpoint;\n    this._location = fields?.location;\n    this._apiVersion = fields?.apiVersion;\n    this.client = client;\n  }\n\n  fieldPlatformType(\n    fields: GoogleConnectionParams<any> | undefined\n  ): GooglePlatformType | undefined {\n    if (typeof fields === \"undefined\") {\n      return undefined;\n    }\n    if (typeof fields.platformType !== \"undefined\") {\n      return fields.platformType;\n    }\n    if (fields.vertexai === true) {\n      return \"gcp\";\n    }\n    return undefined;\n  }\n\n  get platform(): GooglePlatformType {\n    return this.platformType ?? this.computedPlatformType;\n  }\n\n  get computedPlatformType(): GooglePlatformType {\n    return \"gcp\";\n  }\n\n  get computedApiVersion(): string {\n    return \"v1\";\n  }\n\n  get apiVersion(): string {\n    return this._apiVersion ?? this.computedApiVersion;\n  }\n\n  get location(): string {\n    return this._location ?? this.computedLocation;\n  }\n\n  get computedLocation(): string {\n    return \"us-central1\";\n  }\n\n  get endpoint(): string {\n    return this._endpoint ?? this.computedEndpoint;\n  }\n\n  get computedEndpoint(): string {\n    if (this.location === \"global\") {\n      return \"aiplatform.googleapis.com\";\n    } else {\n      return `${this.location}-aiplatform.googleapis.com`;\n    }\n  }\n\n  buildMethod(): GoogleAbstractedClientOpsMethod {\n    return \"POST\";\n  }\n}\n\nexport abstract class GoogleRawConnection<\n  CallOptions extends AsyncCallerCallOptions,\n  AuthOptions\n> extends GoogleHostConnection<CallOptions, GoogleRawResponse, AuthOptions> {\n  async _buildOpts(\n    data: unknown | undefined,\n    _options: CallOptions,\n    requestHeaders: Record<string, string> = {}\n  ): Promise<GoogleAbstractedClientOps> {\n    const opts = await super._buildOpts(data, _options, requestHeaders);\n    opts.responseType = \"blob\";\n    return opts;\n  }\n}\n\nexport abstract class GoogleAIConnection<\n    CallOptions extends AsyncCallerCallOptions,\n    InputType,\n    AuthOptions,\n    ResponseType extends GoogleResponse\n  >\n  extends GoogleHostConnection<CallOptions, ResponseType, AuthOptions>\n  implements GoogleAIBaseLLMInput<AuthOptions>\n{\n  model: string;\n\n  modelName: string;\n\n  client: GoogleAbstractedClient;\n\n  _apiName?: string;\n\n  apiConfig?: GoogleAIAPIConfig;\n\n  constructor(\n    fields: GoogleAIBaseLLMInput<AuthOptions> | undefined,\n    caller: AsyncCaller,\n    client: GoogleAbstractedClient,\n    streaming?: boolean\n  ) {\n    super(fields, caller, client, streaming);\n    this.client = client;\n    this.modelName = fields?.model ?? fields?.modelName ?? this.model;\n    this.model = this.modelName;\n\n    this._apiName = fields?.apiName;\n    this.apiConfig = {\n      safetyHandler: fields?.safetyHandler, // For backwards compatibility\n      ...fields?.apiConfig,\n    };\n  }\n\n  get modelFamily(): VertexModelFamily {\n    return modelToFamily(this.model);\n  }\n\n  get modelPublisher(): string {\n    return modelToPublisher(this.model);\n  }\n\n  get computedAPIName(): string {\n    // At least at the moment, model publishers and APIs map the same\n    return this.modelPublisher;\n  }\n\n  get apiName(): string {\n    return this._apiName ?? this.computedAPIName;\n  }\n\n  get api(): GoogleAIAPI {\n    switch (this.apiName) {\n      case \"google\":\n      case \"gemma\": // TODO: Is this true?\n        return getGeminiAPI(this.apiConfig as GeminiAPIConfig);\n      case \"anthropic\":\n        return getAnthropicAPI(this.apiConfig as AnthropicAPIConfig);\n      default:\n        throw new Error(`Unknown API: ${this.apiName}`);\n    }\n  }\n\n  get isApiKey(): boolean {\n    return this.client.clientType === \"apiKey\";\n  }\n\n  fieldPlatformType(\n    fields: GoogleConnectionParams<any> | undefined\n  ): GooglePlatformType | undefined {\n    const ret = super.fieldPlatformType(fields);\n    if (typeof ret !== \"undefined\") {\n      return ret;\n    }\n    if (fields?.vertexai === false) {\n      return \"gai\";\n    }\n    return undefined;\n  }\n\n  get computedPlatformType(): GooglePlatformType {\n    // This is not a completely correct assumption, since GCP can\n    // have an API Key. But if so, then people need to set the platform\n    // type explicitly.\n    if (this.isApiKey) {\n      return \"gai\";\n    } else {\n      return \"gcp\";\n    }\n  }\n\n  get computedApiVersion(): string {\n    switch (this.platform) {\n      case \"gai\":\n        return \"v1beta\";\n      default:\n        return \"v1\";\n    }\n  }\n\n  get computedLocation(): string {\n    switch (this.apiName) {\n      case \"google\":\n        return super.computedLocation;\n      case \"anthropic\":\n        return \"us-east5\";\n      default:\n        throw new Error(\n          `Unknown apiName: ${this.apiName}. Can't get location.`\n        );\n    }\n  }\n\n  abstract buildUrlMethod(): Promise<string>;\n\n  async buildUrlGenerativeLanguage(): Promise<string> {\n    const method = await this.buildUrlMethod();\n    const url = `https://generativelanguage.googleapis.com/${this.apiVersion}/models/${this.model}:${method}`;\n    return url;\n  }\n\n  async buildUrlVertexExpress(): Promise<string> {\n    const method = await this.buildUrlMethod();\n    const publisher = this.modelPublisher;\n    const url = `https://aiplatform.googleapis.com/${this.apiVersion}/publishers/${publisher}/models/${this.model}:${method}`;\n    return url;\n  }\n\n  async buildUrlVertexLocation(): Promise<string> {\n    const projectId = await this.client.getProjectId();\n    const method = await this.buildUrlMethod();\n    const publisher = this.modelPublisher;\n    const url = `https://${this.endpoint}/${this.apiVersion}/projects/${projectId}/locations/${this.location}/publishers/${publisher}/models/${this.model}:${method}`;\n    return url;\n  }\n\n  async buildUrlVertex(): Promise<string> {\n    if (this.isApiKey) {\n      return this.buildUrlVertexExpress();\n    } else {\n      return this.buildUrlVertexLocation();\n    }\n  }\n\n  async buildUrl(): Promise<string> {\n    switch (this.platform) {\n      case \"gai\":\n        return this.buildUrlGenerativeLanguage();\n      default:\n        return this.buildUrlVertex();\n    }\n  }\n\n  abstract formatData(\n    input: InputType,\n    parameters: GoogleModelParams\n  ): Promise<unknown>;\n\n  async request(\n    input: InputType,\n    parameters: GoogleAIModelRequestParams,\n\n    options: CallOptions,\n    runManager?: BaseRunManager\n  ): Promise<ResponseType> {\n    const moduleName = this.constructor.name;\n    const streamingParameters: GoogleAIModelRequestParams = {\n      ...parameters,\n      streaming: this.streaming,\n    };\n    const data = await this.formatData(input, streamingParameters);\n\n    await runManager?.handleCustomEvent(`google-request-${moduleName}`, {\n      data,\n      parameters: streamingParameters,\n      options,\n      connection: {\n        ...this,\n        url: await this.buildUrl(),\n        urlMethod: await this.buildUrlMethod(),\n        modelFamily: this.modelFamily,\n        modelPublisher: this.modelPublisher,\n        computedPlatformType: this.computedPlatformType,\n      },\n    });\n\n    const response = await this._request(data, options);\n\n    await runManager?.handleCustomEvent(`google-response-${moduleName}`, {\n      response,\n    });\n\n    return response;\n  }\n}\n\nexport abstract class AbstractGoogleLLMConnection<\n  MessageType,\n  AuthOptions\n> extends GoogleAIConnection<\n  BaseLanguageModelCallOptions,\n  MessageType,\n  AuthOptions,\n  GoogleLLMResponse\n> {\n  async buildUrlMethodGemini(): Promise<string> {\n    return this.streaming ? \"streamGenerateContent\" : \"generateContent\";\n  }\n\n  async buildUrlMethodClaude(): Promise<string> {\n    return this.streaming ? \"streamRawPredict\" : \"rawPredict\";\n  }\n\n  async buildUrlMethod(): Promise<string> {\n    switch (this.modelFamily) {\n      case \"gemini\":\n      case \"gemma\": // TODO: Is this true?\n        return this.buildUrlMethodGemini();\n      case \"claude\":\n        return this.buildUrlMethodClaude();\n      default:\n        throw new Error(`Unknown model family: ${this.modelFamily}`);\n    }\n  }\n\n  async formatData(\n    input: MessageType,\n    parameters: GoogleAIModelRequestParams\n  ): Promise<unknown> {\n    // Filter out labels for non-Vertex AI platforms (labels are only supported on Vertex AI)\n    let filteredParameters = parameters;\n    if (parameters.labels && this.platform !== \"gcp\") {\n      const { labels, ...paramsWithoutLabels } = parameters;\n      filteredParameters = paramsWithoutLabels;\n    }\n\n    return this.api.formatData(input, filteredParameters);\n  }\n}\n\nexport interface GoogleCustomEventInfo {\n  subEvent: string;\n  module: string;\n}\n\nexport abstract class GoogleRequestCallbackHandler extends BaseCallbackHandler {\n  customEventInfo(eventName: string): GoogleCustomEventInfo {\n    const names = eventName.split(\"-\");\n    return {\n      subEvent: names[1],\n      module: names[2],\n    };\n  }\n\n  abstract handleCustomRequestEvent(\n    eventName: string,\n    eventInfo: GoogleCustomEventInfo,\n    data: any,\n    runId: string,\n    tags?: string[],\n    metadata?: Record<string, any>\n  ): any;\n\n  abstract handleCustomResponseEvent(\n    eventName: string,\n    eventInfo: GoogleCustomEventInfo,\n    data: any,\n    runId: string,\n    tags?: string[],\n    metadata?: Record<string, any>\n  ): any;\n\n  abstract handleCustomChunkEvent(\n    eventName: string,\n    eventInfo: GoogleCustomEventInfo,\n    data: any,\n    runId: string,\n    tags?: string[],\n    metadata?: Record<string, any>\n  ): any;\n\n  handleCustomEvent(\n    eventName: string,\n    data: any,\n    runId: string,\n    tags?: string[],\n    metadata?: Record<string, any>\n  ): any {\n    if (!eventName) {\n      return undefined;\n    }\n    const eventInfo = this.customEventInfo(eventName);\n    switch (eventInfo.subEvent) {\n      case \"request\":\n        return this.handleCustomRequestEvent(\n          eventName,\n          eventInfo,\n          data,\n          runId,\n          tags,\n          metadata\n        );\n      case \"response\":\n        return this.handleCustomResponseEvent(\n          eventName,\n          eventInfo,\n          data,\n          runId,\n          tags,\n          metadata\n        );\n      case \"chunk\":\n        return this.handleCustomChunkEvent(\n          eventName,\n          eventInfo,\n          data,\n          runId,\n          tags,\n          metadata\n        );\n      default:\n        console.error(\n          `Unexpected eventInfo for ${eventName} ${JSON.stringify(\n            eventInfo,\n            null,\n            1\n          )}`\n        );\n    }\n  }\n}\n\nexport class GoogleRequestLogger extends GoogleRequestCallbackHandler {\n  name: string = \"GoogleRequestLogger\";\n\n  log(eventName: string, data: any, tags?: string[]): undefined {\n    const tagStr = tags ? `[${tags}]` : \"[]\";\n    console.log(`${eventName} ${tagStr} ${JSON.stringify(data, null, 1)}`);\n  }\n\n  handleCustomRequestEvent(\n    eventName: string,\n    _eventInfo: GoogleCustomEventInfo,\n    data: any,\n    _runId: string,\n    tags?: string[],\n    _metadata?: Record<string, any>\n  ): any {\n    this.log(eventName, data, tags);\n  }\n\n  handleCustomResponseEvent(\n    eventName: string,\n    _eventInfo: GoogleCustomEventInfo,\n    data: any,\n    _runId: string,\n    tags?: string[],\n    _metadata?: Record<string, any>\n  ): any {\n    this.log(eventName, data, tags);\n  }\n\n  handleCustomChunkEvent(\n    eventName: string,\n    _eventInfo: GoogleCustomEventInfo,\n    data: any,\n    _runId: string,\n    tags?: string[],\n    _metadata?: Record<string, any>\n  ): any {\n    this.log(eventName, data, tags);\n  }\n}\n\nexport class GoogleRequestRecorder extends GoogleRequestCallbackHandler {\n  name = \"GoogleRequestRecorder\";\n\n  request: any = {};\n\n  response: any = {};\n\n  chunk: any[] = [];\n\n  handleCustomRequestEvent(\n    _eventName: string,\n    _eventInfo: GoogleCustomEventInfo,\n    data: any,\n    _runId: string,\n    _tags?: string[],\n    _metadata?: Record<string, any>\n  ): any {\n    this.request = data;\n  }\n\n  handleCustomResponseEvent(\n    _eventName: string,\n    _eventInfo: GoogleCustomEventInfo,\n    data: any,\n    _runId: string,\n    _tags?: string[],\n    _metadata?: Record<string, any>\n  ): any {\n    this.response = data;\n  }\n\n  handleCustomChunkEvent(\n    _eventName: string,\n    _eventInfo: GoogleCustomEventInfo,\n    data: any,\n    _runId: string,\n    _tags?: string[],\n    _metadata?: Record<string, any>\n  ): any {\n    this.chunk.push(data);\n  }\n}\n"],"mappings":"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"}