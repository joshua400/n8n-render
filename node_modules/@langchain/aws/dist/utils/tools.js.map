{"version":3,"file":"tools.js","names":["tool: unknown","tools: ChatBedrockConverseToolType[]","toolChoice: BedrockConverseToolChoice","tools: BedrockTool[]","fields: {\n    model: string;\n    supportsToolChoiceValues?: Array<\"auto\" | \"any\" | \"tool\">;\n  }","bedrockToolChoice: BedrockToolChoice","model: string"],"sources":["../../src/utils/tools.ts"],"sourcesContent":["import { isOpenAITool } from \"@langchain/core/language_models/base\";\nimport type { Tool as BedrockTool } from \"@aws-sdk/client-bedrock-runtime\";\nimport type { DocumentType as __DocumentType } from \"@smithy/types\";\nimport { isLangChainTool } from \"@langchain/core/utils/function_calling\";\nimport { isInteropZodSchema } from \"@langchain/core/utils/types\";\nimport { toJsonSchema } from \"@langchain/core/utils/json_schema\";\nimport { ChatBedrockConverseToolType, BedrockToolChoice } from \"../types.js\";\n\nexport function isBedrockTool(tool: unknown): tool is BedrockTool {\n  if (typeof tool === \"object\" && tool && \"toolSpec\" in tool) {\n    return true;\n  }\n  return false;\n}\n\nexport function convertToConverseTools(\n  tools: ChatBedrockConverseToolType[]\n): BedrockTool[] {\n  return tools.map((tool, index) => {\n    if (isOpenAITool(tool)) {\n      return {\n        toolSpec: {\n          name: tool.function.name,\n          description: tool.function.description,\n          inputSchema: {\n            json: tool.function.parameters as __DocumentType,\n          },\n        },\n      };\n    } else if (isLangChainTool(tool)) {\n      return {\n        toolSpec: {\n          name: tool.name,\n          description: tool.description,\n          inputSchema: {\n            json: (isInteropZodSchema(tool.schema)\n              ? toJsonSchema(tool.schema)\n              : tool.schema) as __DocumentType,\n          },\n        },\n      };\n    } else if (isBedrockTool(tool)) {\n      return tool;\n    }\n\n    const toolInfo =\n      typeof tool === \"object\" && tool !== null\n        ? `Tool at index ${index}: ${JSON.stringify(tool, null, 2)}`\n        : `Tool at index ${index}: ${String(tool)}`;\n    throw new Error(\n      `Invalid tool passed at index ${index}. Must be a StructuredToolInterface, ToolDefinition, or BedrockTool. ${toolInfo}`\n    );\n  });\n}\n\nexport type BedrockConverseToolChoice =\n  | \"any\"\n  | \"auto\"\n  | string\n  | BedrockToolChoice;\n\nexport function convertToBedrockToolChoice(\n  toolChoice: BedrockConverseToolChoice,\n  tools: BedrockTool[],\n  fields: {\n    model: string;\n    supportsToolChoiceValues?: Array<\"auto\" | \"any\" | \"tool\">;\n  }\n): BedrockToolChoice {\n  const supportsToolChoiceValues = fields.supportsToolChoiceValues ?? [];\n\n  let bedrockToolChoice: BedrockToolChoice;\n  if (typeof toolChoice === \"string\") {\n    switch (toolChoice) {\n      case \"any\":\n        bedrockToolChoice = {\n          any: {},\n        };\n        break;\n      case \"auto\":\n        bedrockToolChoice = {\n          auto: {},\n        };\n        break;\n      default: {\n        const foundTool = tools.find(\n          (tool) => tool.toolSpec?.name === toolChoice\n        );\n        if (!foundTool) {\n          throw new Error(\n            `Tool with name ${toolChoice} not found in tools list.`\n          );\n        }\n        bedrockToolChoice = {\n          tool: {\n            name: toolChoice,\n          },\n        };\n      }\n    }\n  } else {\n    bedrockToolChoice = toolChoice;\n  }\n\n  const toolChoiceType = Object.keys(bedrockToolChoice)[0] as\n    | \"auto\"\n    | \"any\"\n    | \"tool\";\n  if (!supportsToolChoiceValues.includes(toolChoiceType)) {\n    let supportedTxt = \"\";\n    if (supportsToolChoiceValues.length) {\n      supportedTxt =\n        `Model ${fields.model} does not currently support 'tool_choice' ` +\n        `of type ${toolChoiceType}. The following 'tool_choice' types ` +\n        `are supported: ${supportsToolChoiceValues.join(\", \")}.`;\n    } else {\n      supportedTxt = `Model ${fields.model} does not currently support 'tool_choice'.`;\n    }\n\n    throw new Error(\n      `${supportedTxt} Please see` +\n        \"https://docs.aws.amazon.com/bedrock/latest/APIReference/API_runtime_ToolChoice.html\" +\n        \"for the latest documentation on models that support tool choice.\"\n    );\n  }\n\n  return bedrockToolChoice;\n}\n\nexport function supportedToolChoiceValuesForModel(\n  model: string\n): Array<\"auto\" | \"any\" | \"tool\"> | undefined {\n  if (\n    model.includes(\"claude-3\") ||\n    model.includes(\"claude-4\") ||\n    model.includes(\"claude-opus-4\") ||\n    model.includes(\"claude-sonnet-4\")\n  ) {\n    return [\"auto\", \"any\", \"tool\"];\n  }\n  if (model.includes(\"mistral-large\")) {\n    return [\"auto\", \"any\"];\n  }\n  return undefined;\n}\n"],"mappings":";;;;;;AAQA,SAAgB,cAAcA,MAAoC;AAChE,KAAI,OAAO,SAAS,YAAY,QAAQ,cAAc,KACpD,QAAO;AAET,QAAO;AACR;AAED,SAAgB,uBACdC,OACe;AACf,QAAO,MAAM,IAAI,CAAC,MAAM,UAAU;AAChC,MAAI,aAAa,KAAK,CACpB,QAAO,EACL,UAAU;GACR,MAAM,KAAK,SAAS;GACpB,aAAa,KAAK,SAAS;GAC3B,aAAa,EACX,MAAM,KAAK,SAAS,WACrB;EACF,EACF;WACQ,gBAAgB,KAAK,CAC9B,QAAO,EACL,UAAU;GACR,MAAM,KAAK;GACX,aAAa,KAAK;GAClB,aAAa,EACX,MAAO,mBAAmB,KAAK,OAAO,GAClC,aAAa,KAAK,OAAO,GACzB,KAAK,OACV;EACF,EACF;WACQ,cAAc,KAAK,CAC5B,QAAO;EAGT,MAAM,WACJ,OAAO,SAAS,YAAY,SAAS,OACjC,CAAC,cAAc,EAAE,MAAM,EAAE,EAAE,KAAK,UAAU,MAAM,MAAM,EAAE,EAAE,GAC1D,CAAC,cAAc,EAAE,MAAM,EAAE,EAAE,OAAO,KAAK,EAAE;AAC/C,QAAM,IAAI,MACR,CAAC,6BAA6B,EAAE,MAAM,qEAAqE,EAAE,UAAU;CAE1H,EAAC;AACH;AAQD,SAAgB,2BACdC,YACAC,OACAC,QAImB;CACnB,MAAM,2BAA2B,OAAO,4BAA4B,CAAE;CAEtE,IAAIC;AACJ,KAAI,OAAO,eAAe,SACxB,SAAQ,YAAR;EACE,KAAK;GACH,oBAAoB,EAClB,KAAK,CAAE,EACR;AACD;EACF,KAAK;GACH,oBAAoB,EAClB,MAAM,CAAE,EACT;AACD;EACF,SAAS;GACP,MAAM,YAAY,MAAM,KACtB,CAAC,SAAS,KAAK,UAAU,SAAS,WACnC;AACD,OAAI,CAAC,UACH,OAAM,IAAI,MACR,CAAC,eAAe,EAAE,WAAW,yBAAyB,CAAC;GAG3D,oBAAoB,EAClB,MAAM,EACJ,MAAM,WACP,EACF;EACF;CACF;MAED,oBAAoB;CAGtB,MAAM,iBAAiB,OAAO,KAAK,kBAAkB,CAAC;AAItD,KAAI,CAAC,yBAAyB,SAAS,eAAe,EAAE;EACtD,IAAI,eAAe;AACnB,MAAI,yBAAyB,QAC3B,eACE,CAAC,MAAM,EAAE,OAAO,MAAM,kDAA0C,EACrD,eAAe,mDAAoC,EAC5C,yBAAyB,KAAK,KAAK,CAAC,CAAC,CAAC;OAE1D,eAAe,CAAC,MAAM,EAAE,OAAO,MAAM,0CAA0C,CAAC;AAGlF,QAAM,IAAI,MACR,GAAG,aAAa,8JAAW,CAEyC;CAEvE;AAED,QAAO;AACR;AAED,SAAgB,kCACdC,OAC4C;AAC5C,KACE,MAAM,SAAS,WAAW,IAC1B,MAAM,SAAS,WAAW,IAC1B,MAAM,SAAS,gBAAgB,IAC/B,MAAM,SAAS,kBAAkB,CAEjC,QAAO;EAAC;EAAQ;EAAO;CAAO;AAEhC,KAAI,MAAM,SAAS,gBAAgB,CACjC,QAAO,CAAC,QAAQ,KAAM;AAExB,QAAO;AACR"}