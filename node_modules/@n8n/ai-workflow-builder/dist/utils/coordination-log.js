"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getLastCompletedPhase = getLastCompletedPhase;
exports.getPhaseEntry = getPhaseEntry;
exports.hasPhaseCompleted = hasPhaseCompleted;
exports.getConfiguratorOutput = getConfiguratorOutput;
exports.getBuilderOutput = getBuilderOutput;
exports.getPhaseMetadata = getPhaseMetadata;
exports.hasErrorInLog = hasErrorInLog;
exports.getErrorEntry = getErrorEntry;
exports.getNextPhaseFromLog = getNextPhaseFromLog;
exports.summarizeCoordinationLog = summarizeCoordinationLog;
function getLastCompletedPhase(log) {
    if (log.length === 0)
        return null;
    for (let i = log.length - 1; i >= 0; i--) {
        if (log[i].status === 'completed') {
            return log[i].phase;
        }
    }
    return null;
}
function getPhaseEntry(log, phase) {
    return log.find((entry) => entry.phase === phase && entry.status === 'completed') ?? null;
}
function hasPhaseCompleted(log, phase) {
    return log.some((entry) => entry.phase === phase && entry.status === 'completed');
}
function getConfiguratorOutput(log) {
    const entry = getPhaseEntry(log, 'configurator');
    return entry?.output ?? null;
}
function getBuilderOutput(log) {
    const entry = getPhaseEntry(log, 'builder');
    return entry?.output ?? null;
}
function getPhaseMetadata(log, phase) {
    const entry = getPhaseEntry(log, phase);
    if (!entry)
        return null;
    if (entry.metadata.phase === 'error')
        return null;
    return entry.metadata;
}
function hasErrorInLog(log) {
    return log.some((entry) => entry.status === 'error');
}
function getErrorEntry(log) {
    return log.find((entry) => entry.status === 'error') ?? null;
}
function getNextPhaseFromLog(log) {
    if (hasErrorInLog(log)) {
        return 'responder';
    }
    const lastPhase = getLastCompletedPhase(log);
    if (lastPhase === 'discovery') {
        return 'builder';
    }
    if (lastPhase === 'builder') {
        return 'configurator';
    }
    if (lastPhase === 'configurator') {
        return 'responder';
    }
    return 'responder';
}
function summarizeCoordinationLog(log) {
    if (log.length === 0)
        return 'No phases completed';
    return log
        .filter((e) => e.status === 'completed')
        .map((e) => `${e.phase}: ${e.summary}`)
        .join(' â†’ ');
}
//# sourceMappingURL=coordination-log.js.map