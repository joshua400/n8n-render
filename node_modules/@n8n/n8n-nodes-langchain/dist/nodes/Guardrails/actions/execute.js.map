{"version":3,"sources":["../../../../nodes/Guardrails/actions/execute.ts"],"sourcesContent":["import type { IExecuteFunctions, INodeExecutionData } from 'n8n-workflow';\n\nimport { process } from './process';\nimport type { GuardrailsOptions } from './types';\nimport { hasLLMGuardrails } from '../helpers/configureNodeInputs';\nimport { getChatModel } from '../helpers/model';\n\nexport async function execute(this: IExecuteFunctions): Promise<INodeExecutionData[][]> {\n\tconst items = this.getInputData();\n\tconst operation = this.getNodeParameter('operation', 0) as 'classify' | 'sanitize';\n\tconst model = hasLLMGuardrails(this.getNodeParameter('guardrails', 0) as GuardrailsOptions)\n\t\t? await getChatModel.call(this)\n\t\t: null;\n\n\tconst failedItems: INodeExecutionData[] = [];\n\tconst passedItems: INodeExecutionData[] = [];\n\tfor (let i = 0; i < items.length; i++) {\n\t\ttry {\n\t\t\tconst responseData = await process.call(this, i, model);\n\t\t\tif (responseData.passed) {\n\t\t\t\tpassedItems.push({\n\t\t\t\t\tjson: { guardrailsInput: responseData.guardrailsInput, ...responseData.passed },\n\t\t\t\t\tpairedItem: { item: i },\n\t\t\t\t});\n\t\t\t}\n\t\t\tif (responseData.failed) {\n\t\t\t\tfailedItems.push({\n\t\t\t\t\tjson: { guardrailsInput: responseData.guardrailsInput, ...responseData.failed },\n\t\t\t\t\tpairedItem: { item: i },\n\t\t\t\t});\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tif (this.continueOnFail()) {\n\t\t\t\tfailedItems.push({\n\t\t\t\t\tjson: { error: error.message, guardrailsInput: '' },\n\t\t\t\t\tpairedItem: { item: i },\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthrow error;\n\t\t\t}\n\t\t}\n\t}\n\n\tif (operation === 'classify') {\n\t\treturn [passedItems, failedItems];\n\t}\n\n\treturn [passedItems];\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,qBAAwB;AAExB,iCAAiC;AACjC,mBAA6B;AAE7B,eAAsB,UAAkE;AACvF,QAAM,QAAQ,KAAK,aAAa;AAChC,QAAM,YAAY,KAAK,iBAAiB,aAAa,CAAC;AACtD,QAAM,YAAQ,6CAAiB,KAAK,iBAAiB,cAAc,CAAC,CAAsB,IACvF,MAAM,0BAAa,KAAK,IAAI,IAC5B;AAEH,QAAM,cAAoC,CAAC;AAC3C,QAAM,cAAoC,CAAC;AAC3C,WAAS,IAAI,GAAG,IAAI,MAAM,QAAQ,KAAK;AACtC,QAAI;AACH,YAAM,eAAe,MAAM,uBAAQ,KAAK,MAAM,GAAG,KAAK;AACtD,UAAI,aAAa,QAAQ;AACxB,oBAAY,KAAK;AAAA,UAChB,MAAM,EAAE,iBAAiB,aAAa,iBAAiB,GAAG,aAAa,OAAO;AAAA,UAC9E,YAAY,EAAE,MAAM,EAAE;AAAA,QACvB,CAAC;AAAA,MACF;AACA,UAAI,aAAa,QAAQ;AACxB,oBAAY,KAAK;AAAA,UAChB,MAAM,EAAE,iBAAiB,aAAa,iBAAiB,GAAG,aAAa,OAAO;AAAA,UAC9E,YAAY,EAAE,MAAM,EAAE;AAAA,QACvB,CAAC;AAAA,MACF;AAAA,IACD,SAAS,OAAO;AACf,UAAI,KAAK,eAAe,GAAG;AAC1B,oBAAY,KAAK;AAAA,UAChB,MAAM,EAAE,OAAO,MAAM,SAAS,iBAAiB,GAAG;AAAA,UAClD,YAAY,EAAE,MAAM,EAAE;AAAA,QACvB,CAAC;AAAA,MACF,OAAO;AACN,cAAM;AAAA,MACP;AAAA,IACD;AAAA,EACD;AAEA,MAAI,cAAc,YAAY;AAC7B,WAAO,CAAC,aAAa,WAAW;AAAA,EACjC;AAEA,SAAO,CAAC,WAAW;AACpB;","names":[]}