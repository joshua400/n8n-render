{"version":3,"sources":["../../../../../../../../nodes/agents/Agent/agents/ToolsAgent/V3/helpers/buildResponseMetadata.ts"],"sourcesContent":["import type { EngineResponse } from 'n8n-workflow';\n\nimport { buildSteps } from '@utils/agent-execution';\n\nimport type { RequestResponseMetadata } from '../types';\n\n/**\n * Builds metadata for an engine request, tracking iteration count and previous requests.\n *\n * This helper centralizes the logic for incrementing iteration count and building\n * the request history, which is used to enforce max iterations and maintain context.\n *\n * @param response - The optional engine response from previous tool execution\n * @param itemIndex - The current item index being processed\n * @returns Metadata object with previousRequests and iterationCount\n *\n */\nexport function buildResponseMetadata(\n\tresponse: EngineResponse<RequestResponseMetadata> | undefined,\n\titemIndex: number,\n): RequestResponseMetadata {\n\tconst currentIterationCount = response?.metadata?.iterationCount ?? 0;\n\n\treturn {\n\t\tpreviousRequests: buildSteps(response, itemIndex),\n\t\titemIndex,\n\t\titerationCount: currentIterationCount + 1,\n\t};\n}\n"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA,6BAA2B;AAepB,SAAS,sBACf,UACA,WAC0B;AAC1B,QAAM,wBAAwB,UAAU,UAAU,kBAAkB;AAEpE,SAAO;AAAA,IACN,sBAAkB,mCAAW,UAAU,SAAS;AAAA,IAChD;AAAA,IACA,gBAAgB,wBAAwB;AAAA,EACzC;AACD;","names":[]}